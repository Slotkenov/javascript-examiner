<lnk rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import"
      href="../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="je-login" attributes="router session">
  <template>
    <style>
      .error {
        font-seize: bigger;
        font-weight: bold;
        color: red;
      }
    </style>

    <h1>Log in</h1>

    <template if="{{showError}}">
      <p class="error">{{error}}</p>
    </template>

    <p>
      <paper-input-decorator label="Your email address">
        <paper-input value="{{email}}"></paper-input>
      </paper-input-decorator>
      <paper-input-decorator label="Your new password">
        <paper-input type="password" value="{{password}}"></paper-input>
      </paper-input-decorator>
      <paper-input-decorator label="Repeat your password">
        <paper-input type="password" value="{{passwordRepeat}}"></paper-input>
      </paper-input-decorator>
      <paper-button raised on-click="{{onSubmitClick}}">
        Submit password
      </paper-button>
    </p>

    <core-ajax id="resetPassword" url="/reset-password"
               method="post" contentType="application/json"
               handleAs="json"
               body='{
                  "resetPasswordToken": "{{token}}",
                  "email":"{{email}}",
                  "password":"{{password}}"
               }'
               on-core-response="{{onResetResponse}}"
               on-core-error="{{onResetError}}">
    </core-ajax>

  </template>
  <script>
    Polymer({
      ready: function() {
        error: '',
        showError: false,
        token: '',
        email: '',
        password: '',
        password-again: ''
      },
      onSubmitClick: function() {
        this.showError = false;
        if (this.password === this.password-again) {
          this.$.resetPassword.go();
        } else {
          this.error = 'Your passwords do not match';
          this.showError = true;
        }
      },
      onResetResponse: function(response) {
        console.log(response);
        this.error = response.detail.response.message;
        this.showError = true;
      },
      onResetError: function(response) {
        console.log(response);
        this.error = response.detail.response.message;
        this.showError = true;
      }

    });
  </script>
</polymer-element>
